function u(n){return n?n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""):""}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("modalAgregarArticulo"),d=document.getElementById("modalEditarArticulo"),E=document.getElementById("agregarArticulo"),f=document.getElementById("cancelarModalArticulo"),I=document.getElementById("cancelarModalEditar"),l=document.getElementById("formAgregarArticulo"),s=document.getElementById("formEditarArticulo"),p=document.getElementById("inputSearch"),y=document.querySelector("tbody");E?.addEventListener("click",()=>{n?.classList.remove("hidden")});function m(){n?.classList.add("hidden")}function g(){d?.classList.add("hidden")}f?.addEventListener("click",m),I?.addEventListener("click",g),n?.addEventListener("click",a=>{a.target===n&&m()}),d?.addEventListener("click",a=>{a.target===d&&g()});function h(){const a=u(p.value);(y?.querySelectorAll("tr")||[]).forEach(t=>{const e=u(t.children[1].textContent),o=u(t.children[4].textContent),i=u(t.children[5].textContent),c=e.includes(a)||o.includes(a)||i.includes(a);t.style.display=c?"":"none"})}p?.addEventListener("input",h);function v(){document.querySelectorAll("button.text-red-600").forEach(r=>{r.addEventListener("click",async function(){const t=this.getAttribute("data-id");if(confirm(`¿Está seguro que desea eliminar el artículo con ID ${t}?`))try{if((await fetch(`http://localhost:5183/api/Articulos/${t}`,{method:"DELETE"})).ok)alert("Artículo eliminado correctamente"),window.location.reload();else throw new Error("Error al eliminar el artículo")}catch(e){alert(e.message),console.error("Error:",e)}})})}function A(){document.querySelectorAll("button.text-blue-600").forEach(r=>{r.addEventListener("click",function(){const t=this.getAttribute("data-articulo");if(!t)return;const e=JSON.parse(t);document.getElementById("editarArticuloId").value=e.id.toString(),document.getElementById("editarDescripcion").value=e.descripcion,document.getElementById("editarPrecioAlquiler").value=e.precioAlquiler.toString(),document.getElementById("editarPrecioProveedor").value=e.precioProveedor.toString(),document.getElementById("editarCantidad").value=e.cantidad.toString(),document.getElementById("editarReparacion").value=e.reparacion.toString(),document.getElementById("editarProveedorId").value=e.proveedorId.toString(),document.getElementById("editarCategoriaId").value=e.categoriaId.toString(),d?.classList.remove("hidden")})})}v(),A(),l?.addEventListener("submit",async a=>{if(a.preventDefault(),!l)return;const r=l.querySelector('button[type="submit"]');r.disabled=!0,r.innerHTML="Guardando...";try{const t=new FormData(l),e=Object.fromEntries(t.entries()),o={descripcion:e.descripcion,precioAlquiler:parseFloat(e.precioAlquiler),precioProveedor:parseFloat(e.precioProveedor),cantidad:parseInt(e.cantidad),disponible:parseInt(e.cantidad)-(parseInt(e.reparacion)||0),reparacion:parseInt(e.reparacion)||0,proveedorId:parseInt(e.proveedorId),categoriaId:parseInt(e.categoriaId)};console.log("aquiii Articulo Data:",o);const i=await fetch("http://localhost:5183/api/Articulos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){const c=await i.json();throw new Error(c.message||"Error al guardar el artículo")}alert("Artículo guardado correctamente"),window.location.reload()}catch(t){alert(t.message),console.error("Error:",t)}finally{r&&(r.disabled=!1,r.innerHTML="Guardar Artículo")}}),s?.addEventListener("submit",async a=>{if(a.preventDefault(),!s)return;const r=s.querySelector('button[type="submit"]');r.disabled=!0,r.innerHTML="Actualizando...";try{const t=new FormData(s),e=t.get("id"),o=Object.fromEntries(t.entries()),i={id:parseInt(e),descripcion:o.descripcion,precioAlquiler:parseFloat(o.precioAlquiler),precioProveedor:parseFloat(o.precioProveedor),cantidad:parseInt(o.cantidad),disponible:parseInt(o.cantidad)-(parseInt(o.reparacion)||0),reparacion:parseInt(o.reparacion)||0,proveedorId:parseInt(o.proveedorId),categoriaId:parseInt(o.categoriaId)},c=await fetch(`http://localhost:5183/api/Articulos/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!c.ok){const B=await c.json();throw new Error(B.message||"Error al actualizar el artículo")}alert("Artículo actualizado correctamente"),window.location.reload()}catch(t){alert(t.message),console.error("Error:",t)}finally{r&&(r.disabled=!1,r.innerHTML="Actualizar Artículo")}})});
