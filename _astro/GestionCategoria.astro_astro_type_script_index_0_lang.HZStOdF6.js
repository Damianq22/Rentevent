let l=[];async function s(){try{const e=await fetch("http://localhost:5183/api/Categorias");e.ok?(l=await e.json(),f(l)):console.error("Error cargando categorías:",e.statusText)}catch(e){console.error("Error:",e)}}function f(e){const r=document.getElementById("categoriaTable");r&&(r.innerHTML=e.map(t=>`
      <tr class="border-b bg-[#e9eef6] hover:bg-gray-50">
        <td class="w-4 p-4">
          <input type="checkbox" class="form-checkbox categoriaCheckbox" data-id="${t.id}" />
        </td>
        <td class="px-6 py-4 text-black">${t.id}</td>
        <td class="px-6 py-4 text-black">${t.descripcion}</td>
        <td class="px-6 py-4">
          <button class="text-blue-600 hover:text-blue-900 mr-3 editar-btn" data-id="${t.id}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
          </button>
          <button class="text-red-600 hover:text-red-900 eliminar-btn" data-id="${t.id}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
        </td>
      </tr>
    `).join(""),document.querySelectorAll(".editar-btn").forEach(t=>{t.addEventListener("click",i=>{const o=i.currentTarget.dataset.id;o&&h(parseInt(o))})}),document.querySelectorAll(".eliminar-btn").forEach(t=>{t.addEventListener("click",i=>{const o=i.currentTarget.dataset.id;o&&E(parseInt(o))})}))}function y(){const e=document.getElementById("inputSearch");e&&e.addEventListener("input",r=>{const i=r.target.value.toLowerCase(),n=l.filter(o=>o.descripcion.toLowerCase().includes(i));f(n)})}function h(e){const r=l.find(o=>o.id===e);if(!r)return;const t=document.getElementById("editCategoriaId"),i=document.getElementById("editCategoriaDescripcion"),n=document.getElementById("modalEditar");t&&i&&n&&(t.value=r.id.toString(),i.value=r.descripcion,n.classList.remove("hidden"))}function E(e){confirm("¿Estás seguro de que deseas eliminar esta categoría?")&&b(e)}async function b(e){try{(await fetch(`http://localhost:5183/api/Categorias/${e}`,{method:"DELETE"})).ok?(alert("Categoría eliminada correctamente"),await s()):alert("Error al eliminar la categoría")}catch(r){console.error("Error:",r),alert("Error al eliminar la categoría")}}document.addEventListener("DOMContentLoaded",()=>{s(),y();const e=document.getElementById("modalAgregar"),r=document.getElementById("agregarCategoria"),t=document.getElementById("cancelarModal"),i=document.getElementById("cancelarModalEditar");r&&e&&r.addEventListener("click",()=>{e.classList.remove("hidden")}),t&&e&&t.addEventListener("click",()=>{e.classList.add("hidden")});const n=document.getElementById("modalEditar");i&&n&&i.addEventListener("click",()=>{n.classList.add("hidden")}),window.addEventListener("click",a=>{a.target===e&&a.target.classList.add("hidden"),a.target===n&&a.target.classList.add("hidden")});const o=document.getElementById("formAgregarCategoria");o&&o.addEventListener("submit",async a=>{a.preventDefault();const d=new FormData(o);try{(await fetch("http://localhost:5183/api/Categorias",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({descripcion:d.get("descripcion")})})).ok?(alert("Categoría agregada correctamente"),o.reset(),e&&e.classList.add("hidden"),await s()):alert("Error al agregar la categoría")}catch(c){console.error("Error:",c),alert("Error al agregar la categoría")}});const g=document.getElementById("formEditarCategoria");g&&g.addEventListener("submit",async a=>{a.preventDefault();const d=new FormData(g),c=d.get("id");try{(await fetch(`http://localhost:5183/api/Categorias/${c}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:parseInt(c),descripcion:d.get("descripcion")})})).ok?(alert("Categoría actualizada correctamente"),n&&n.classList.add("hidden"),await s()):alert("Error al actualizar la categoría")}catch(p){console.error("Error:",p),alert("Error al actualizar la categoría")}});const m=document.getElementById("editarCategoria"),u=document.getElementById("eliminarCategoria");m&&m.addEventListener("click",()=>{const a=document.querySelector(".categoriaCheckbox:checked");a&&a.dataset.id?h(parseInt(a.dataset.id)):alert("Seleccione una categoría para editar")}),u&&u.addEventListener("click",()=>{const a=document.querySelector(".categoriaCheckbox:checked");a&&a.dataset.id?E(parseInt(a.dataset.id)):alert("Seleccione una categoría para eliminar")})});
